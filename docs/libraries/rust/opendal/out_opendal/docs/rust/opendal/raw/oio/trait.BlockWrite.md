# Trait BlockWrite Copy item path

<a href="https://opendal.apache.org/docs/rust/src/opendal/raw/oio/write/block_write.rs.html#60-94" class="src">Source</a>

``` rust
pub trait BlockWrite:
    Send
    + Sync
    + Unpin
    + 'static {
    // Required methods
    fn write_once(
        &self,
        size: u64,
        body: Buffer,
    ) -> impl Future<Output = Result<Metadata>> + MaybeSend;
    fn write_block(
        &self,
        block_id: Uuid,
        size: u64,
        body: Buffer,
    ) -> impl Future<Output = Result<()>> + MaybeSend;
    fn complete_block(
        &self,
        block_ids: Vec<Uuid>,
    ) -> impl Future<Output = Result<Metadata>> + MaybeSend;
    fn abort_block(
        &self,
        block_ids: Vec<Uuid>,
    ) -> impl Future<Output = Result<()>> + MaybeSend;
}
```

Expand description

BlockWrite is used to implement [`oio::Write`](https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.Write.html "trait opendal::raw::oio::Write") based on block uploads. By implementing BlockWrite, services donâ€™t need to care about the details of uploading blocks.

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#architecture" class="doc-anchor">Â§</a>Architecture

The architecture after adopting [`BlockWrite`](https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html "trait opendal::raw::oio::BlockWrite"):

- Services impl `BlockWrite`
- `BlockWriter` impl `Write`
- Expose `BlockWriter` as `Accessor::Writer`

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#notes" class="doc-anchor">Â§</a>Notes

`BlockWrite` has an oneshot optimization when `write` has been called only once:

``` no_build
w.write(bs).await?;
w.close().await?;
```

We will use `write_once` instead of starting a new block upload.

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#requirements" class="doc-anchor">Â§</a>Requirements

Services that implement `BlockWrite` must fulfill the following requirements:

- Must be a http service that could accept `AsyncBody`.
- Donâ€™t need initialization before writing.
- Block ID is generated by caller `BlockWrite` instead of services.
- Complete block by an ordered block id list.

## Required Methods<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#required-methods" class="anchor">Â§</a>

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#tymethod.write_once" class="fn">write_once</a>( &self, size: <a href="https://doc.rust-lang.org/nightly/std/primitive.u64.html" class="primitive">u64</a>, body: <a href="https://opendal.apache.org/docs/rust/opendal/struct.Buffer.html" class="struct" title="struct opendal::Buffer">Buffer</a>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://opendal.apache.org/docs/rust/opendal/struct.Metadata.html" class="struct" title="struct opendal::Metadata">Metadata</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

write_once is used to write the data to underlying storage at once.

BlockWriter will call this API when:

- All the data has been written to the buffer and we can perform the upload at once.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#tymethod.write_block" class="fn">write_block</a>( &self, block_id: <a href="https://docs.rs/uuid/1.18.1/uuid/struct.Uuid.html" class="struct" title="struct uuid::Uuid">Uuid</a>, size: <a href="https://doc.rust-lang.org/nightly/std/primitive.u64.html" class="primitive">u64</a>, body: <a href="https://opendal.apache.org/docs/rust/opendal/struct.Buffer.html" class="struct" title="struct opendal::Buffer">Buffer</a>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://doc.rust-lang.org/nightly/std/primitive.unit.html" class="primitive">()</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

write_block will write a block of the data.

BlockWriter will call this API and stores the result in order.

- block_id is the id of the block.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#tymethod.complete_block" class="fn">complete_block</a>( &self, block_ids: <a href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" class="struct" title="struct alloc::vec::Vec">Vec</a>\<<a href="https://docs.rs/uuid/1.18.1/uuid/struct.Uuid.html" class="struct" title="struct uuid::Uuid">Uuid</a>\>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://opendal.apache.org/docs/rust/opendal/struct.Metadata.html" class="struct" title="struct opendal::Metadata">Metadata</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

complete_block will complete the block upload to build the final file.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#tymethod.abort_block" class="fn">abort_block</a>( &self, block_ids: <a href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" class="struct" title="struct alloc::vec::Vec">Vec</a>\<<a href="https://docs.rs/uuid/1.18.1/uuid/struct.Uuid.html" class="struct" title="struct uuid::Uuid">Uuid</a>\>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://doc.rust-lang.org/nightly/std/primitive.unit.html" class="primitive">()</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

abort_block will cancel the block upload and purge all data.

## Dyn Compatibility<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#dyn-compatibility" class="anchor">Â§</a>

This trait is **not** [dyn compatible](https://doc.rust-lang.org/nightly/reference/items/traits.html#dyn-compatibility).

*In older versions of Rust, dyn compatibility was called "object safety", so this trait is not object safe.*

## Implementors<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.BlockWrite.html#implementors" class="anchor">Â§</a>
