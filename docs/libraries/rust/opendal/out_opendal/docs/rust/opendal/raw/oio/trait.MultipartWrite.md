# Trait MultipartWrite Copy item path

<a href="https://opendal.apache.org/docs/rust/src/opendal/raw/oio/write/multipart_write.rs.html#58-104" class="src">Source</a>

``` rust
pub trait MultipartWrite:
    Send
    + Sync
    + Unpin
    + 'static {
    // Required methods
    fn write_once(
        &self,
        size: u64,
        body: Buffer,
    ) -> impl Future<Output = Result<Metadata>> + MaybeSend;
    fn initiate_part(&self) -> impl Future<Output = Result<String>> + MaybeSend;
    fn write_part(
        &self,
        upload_id: &str,
        part_number: usize,
        size: u64,
        body: Buffer,
    ) -> impl Future<Output = Result<MultipartPart>> + MaybeSend;
    fn complete_part(
        &self,
        upload_id: &str,
        parts: &[MultipartPart],
    ) -> impl Future<Output = Result<Metadata>> + MaybeSend;
    fn abort_part(
        &self,
        upload_id: &str,
    ) -> impl Future<Output = Result<()>> + MaybeSend;
}
```

Expand description

MultipartWrite is used to implement [`oio::Write`](https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.Write.html "trait opendal::raw::oio::Write") based on multipart uploads. By implementing MultipartWrite, services donâ€™t need to care about the details of uploading parts.

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#architecture" class="doc-anchor">Â§</a>Architecture

The architecture after adopting [`MultipartWrite`](https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html "trait opendal::raw::oio::MultipartWrite"):

- Services impl `MultipartWrite`
- `MultipartWriter` impl `Write`
- Expose `MultipartWriter` as `Accessor::Writer`

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#notes" class="doc-anchor">Â§</a>Notes

`MultipartWrite` has an oneshot optimization when `write` has been called only once:

``` no_build
w.write(bs).await?;
w.close().await?;
```

We will use `write_once` instead of starting a new multipart upload.

## <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#requirements" class="doc-anchor">Â§</a>Requirements

Services that implement `BlockWrite` must fulfill the following requirements:

- Must be a http service that could accept `AsyncBody`.
- Donâ€™t need initialization before writing.
- Block ID is generated by caller `BlockWrite` instead of services.
- Complete block by an ordered block id list.

## Required Methods<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#required-methods" class="anchor">Â§</a>

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#tymethod.write_once" class="fn">write_once</a>( &self, size: <a href="https://doc.rust-lang.org/nightly/std/primitive.u64.html" class="primitive">u64</a>, body: <a href="https://opendal.apache.org/docs/rust/opendal/struct.Buffer.html" class="struct" title="struct opendal::Buffer">Buffer</a>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://opendal.apache.org/docs/rust/opendal/struct.Metadata.html" class="struct" title="struct opendal::Metadata">Metadata</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

write_once is used to write the data to underlying storage at once.

MultipartWriter will call this API when:

- All the data has been written to the buffer and we can perform the upload at once.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#tymethod.initiate_part" class="fn">initiate_part</a>(&self) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" class="struct" title="struct alloc::string::String">String</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

initiate_part will call start a multipart upload and return the upload id.

MultipartWriter will call this when:

- the total size of data is unknown.
- the total size of data is known, but the size of current write is less than the total size.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#tymethod.write_part" class="fn">write_part</a>( &self, upload_id: &<a href="https://doc.rust-lang.org/nightly/std/primitive.str.html" class="primitive">str</a>, part_number: <a href="https://doc.rust-lang.org/nightly/std/primitive.usize.html" class="primitive">usize</a>, size: <a href="https://doc.rust-lang.org/nightly/std/primitive.u64.html" class="primitive">u64</a>, body: <a href="https://opendal.apache.org/docs/rust/opendal/struct.Buffer.html" class="struct" title="struct opendal::Buffer">Buffer</a>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/struct.MultipartPart.html" class="struct" title="struct opendal::raw::oio::MultipartPart">MultipartPart</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

write_part will write a part of the data and returns the result [`MultipartPart`](https://opendal.apache.org/docs/rust/opendal/raw/oio/struct.MultipartPart.html "struct opendal::raw::oio::MultipartPart").

MultipartWriter will call this API and stores the result in order.

- part_number is the index of the part, starting from 0.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#tymethod.complete_part" class="fn">complete_part</a>( &self, upload_id: &<a href="https://doc.rust-lang.org/nightly/std/primitive.str.html" class="primitive">str</a>, parts: &\[<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/struct.MultipartPart.html" class="struct" title="struct opendal::raw::oio::MultipartPart">MultipartPart</a>\], ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://opendal.apache.org/docs/rust/opendal/struct.Metadata.html" class="struct" title="struct opendal::Metadata">Metadata</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

complete_part will complete the multipart upload to build the final file.

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#tymethod.abort_part" class="fn">abort_part</a>( &self, upload_id: &<a href="https://doc.rust-lang.org/nightly/std/primitive.str.html" class="primitive">str</a>, ) -\> impl <a href="https://doc.rust-lang.org/nightly/core/future/future/trait.Future.html" class="trait" title="trait core::future::future::Future">Future</a>\<Output = <a href="https://opendal.apache.org/docs/rust/opendal/type.Result.html" class="type" title="type opendal::Result">Result</a>\<<a href="https://doc.rust-lang.org/nightly/std/primitive.unit.html" class="primitive">()</a>\>\> + <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.MaybeSend.html" class="trait" title="trait opendal::raw::MaybeSend">MaybeSend</a>

abort_part will cancel the multipart upload and purge all data.

## Dyn Compatibility<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#dyn-compatibility" class="anchor">Â§</a>

This trait is **not** [dyn compatible](https://doc.rust-lang.org/nightly/reference/items/traits.html#dyn-compatibility).

*In older versions of Rust, dyn compatibility was called "object safety", so this trait is not object safe.*

## Implementors<a href="https://opendal.apache.org/docs/rust/opendal/raw/oio/trait.MultipartWrite.html#implementors" class="anchor">Â§</a>
