# Struct RetryLayer Copy item path

<a href="https://opendal.apache.org/docs/rust/src/opendal/layers/retry.rs.html#119-122" class="src">Source</a>

``` rust
pub struct RetryLayer<I: RetryInterceptor = DefaultRetryInterceptor> { /* private fields */ }
```

Expand description

Add retry for temporary failed operations.

## <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#notes" class="doc-anchor">Â§</a>Notes

This layer will retry failed operations when [`Error::is_temporary`](https://opendal.apache.org/docs/rust/opendal/struct.Error.html#method.is_temporary "method opendal::Error::is_temporary") returns true. If operation still failed, this layer will set error to `Persistent` which means error has been retried.

## <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#panics" class="doc-anchor">Â§</a>Panics

While retrying `Reader` or `Writer` operations, please make sure either:

- All futures generated by `Reader::read` or `Writer::close` are resolved to `Ready`.
- Or, wonâ€™t call any `Reader` or `Writer` methods after retry returns final error.

Otherwise, `RetryLayer` could panic while hitting in bad states.

For example, while composing `RetryLayer` with `TimeoutLayer`. The order of layer is sensitive.

``` rust


let op = Operator::new(services::Memory::default())?
    // This is fine, since timeout happen during retry.
    .layer(TimeoutLayer::new().with_io_timeout(Duration::from_nanos(1)))
    .layer(RetryLayer::new())
    // This is wrong. Since timeout layer will drop future, leaving retry layer in a bad state.
    .layer(TimeoutLayer::new().with_io_timeout(Duration::from_nanos(1)))
    .finish();
Ok(())
```

## <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#examples" class="doc-anchor">Â§</a>Examples

``` rust

let _ = Operator::new(services::Memory::default())?
    .layer(RetryLayer::new())
    .finish();
Ok(())
```

### <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#customize-retry-interceptor" class="doc-anchor">Â§</a>Customize retry interceptor

RetryLayer accepts [`RetryInterceptor`](https://opendal.apache.org/docs/rust/opendal/layers/trait.RetryInterceptor.html "trait opendal::layers::RetryInterceptor") to allow users to customize their own retry interceptor logic.

``` rust


struct MyRetryInterceptor;

impl RetryInterceptor for MyRetryInterceptor {
    fn intercept(&self, err: &Error, dur: Duration) {
        // do something
    }
}

let _ = Operator::new(services::Memory::default())?
    .layer(RetryLayer::new().with_notify(MyRetryInterceptor))
    .finish();
Ok(())
```

## Implementations<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#implementations" class="anchor">Â§</a>

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#impl-RetryLayer" class="anchor">Â§</a>

### impl <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.new" class="fn">new</a>() -\> <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>

Create a new retry layer.

##### <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#examples-1" class="doc-anchor">Â§</a>Examples

``` rust
use anyhow::Result;
use opendal::layers::RetryLayer;
use opendal::services;
use opendal::Operator;
use opendal::Scheme;

let _ = Operator::new(services::Memory::default())
    .expect("must init")
    .layer(RetryLayer::new());
```

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#impl-RetryLayer%3CI%3E" class="anchor">Â§</a>

### impl\<I: <a href="https://opendal.apache.org/docs/rust/opendal/layers/trait.RetryInterceptor.html" class="trait" title="trait opendal::layers::RetryInterceptor">RetryInterceptor</a>\> <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>\<I\>

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_notify" class="fn">with_notify</a>\<NI: <a href="https://opendal.apache.org/docs/rust/opendal/layers/trait.RetryInterceptor.html" class="trait" title="trait opendal::layers::RetryInterceptor">RetryInterceptor</a>\>(self, notify: NI) -\> <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>\<NI\>

Set the retry interceptor as new notify.

``` rust
use opendal::layers::RetryLayer;
use opendal::services;
use opendal::Operator;

fn notify(_err: &opendal::Error, _dur: std::time::Duration) {}

let _ = Operator::new(services::Memory::default())
    .expect("must init")
    .layer(RetryLayer::new().with_notify(notify))
    .finish();
```

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_jitter" class="fn">with_jitter</a>(self) -\> Self

Set jitter of current backoff.

If jitter is enabled, ExponentialBackoff will add a random jitter in \`\[0, min_delay) to current delay.

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_factor" class="fn">with_factor</a>(self, factor: <a href="https://doc.rust-lang.org/nightly/std/primitive.f32.html" class="primitive">f32</a>) -\> Self

Set factor of current backoff.

##### <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#panics-1" class="doc-anchor">Â§</a>Panics

This function will panic if input factor smaller than `1.0`.

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_min_delay" class="fn">with_min_delay</a>(self, min_delay: <a href="https://doc.rust-lang.org/nightly/core/time/struct.Duration.html" class="struct" title="struct core::time::Duration">Duration</a>) -\> Self

Set min_delay of current backoff.

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_max_delay" class="fn">with_max_delay</a>(self, max_delay: <a href="https://doc.rust-lang.org/nightly/core/time/struct.Duration.html" class="struct" title="struct core::time::Duration">Duration</a>) -\> Self

Set max_delay of current backoff.

Delay will not increase if current delay is larger than max_delay.

#### pub fn <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.with_max_times" class="fn">with_max_times</a>(self, max_times: <a href="https://doc.rust-lang.org/nightly/std/primitive.usize.html" class="primitive">usize</a>) -\> Self

Set max_times of current backoff.

Backoff will return `None` if max times is reaching.

## Trait Implementations<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#trait-implementations" class="anchor">Â§</a>

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#impl-Clone-for-RetryLayer%3CI%3E" class="anchor">Â§</a>

### impl\<I: <a href="https://opendal.apache.org/docs/rust/opendal/layers/trait.RetryInterceptor.html" class="trait" title="trait opendal::layers::RetryInterceptor">RetryInterceptor</a>\> <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html" class="trait" title="trait core::clone::Clone">Clone</a> for <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>\<I\>

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.clone" class="anchor">Â§</a>

#### fn <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone" class="fn">clone</a>(&self) -\> Self

Returns a duplicate of the value. [Read more](https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone)

1.0.0 Â· <a href="https://doc.rust-lang.org/nightly/src/core/clone.rs.html#245-247" class="src">Source</a><a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.clone_from" class="anchor">Â§</a>

#### fn <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from" class="fn">clone_from</a>(&mut self, source: &Self)

Performs copy-assignment from `source`. [Read more](https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from)

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#impl-Default-for-RetryLayer" class="anchor">Â§</a>

### impl <a href="https://doc.rust-lang.org/nightly/core/default/trait.Default.html" class="trait" title="trait core::default::Default">Default</a> for <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.default" class="anchor">Â§</a>

#### fn <a href="https://doc.rust-lang.org/nightly/core/default/trait.Default.html#tymethod.default" class="fn">default</a>() -\> Self

Returns the â€œdefault valueâ€? for a type. [Read more](https://doc.rust-lang.org/nightly/core/default/trait.Default.html#tymethod.default)

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#impl-Layer%3CA%3E-for-RetryLayer%3CI%3E" class="anchor">Â§</a>

### impl\<A: <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.Access.html" class="trait" title="trait opendal::raw::Access">Access</a>, I: <a href="https://opendal.apache.org/docs/rust/opendal/layers/trait.RetryInterceptor.html" class="trait" title="trait opendal::layers::RetryInterceptor">RetryInterceptor</a>\> <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.Layer.html" class="trait" title="trait opendal::raw::Layer">Layer</a>\<A\> for <a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html" class="struct" title="struct opendal::layers::RetryLayer">RetryLayer</a>\<I\>

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#associatedtype.LayeredAccess" class="anchor">Â§</a>

#### type <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.Layer.html#associatedtype.LayeredAccess" class="associatedtype">LayeredAccess</a> = RetryAccessor\<A, I\>

The layered accessor that returned by this layer.

<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#method.layer" class="anchor">Â§</a>

#### fn <a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.Layer.html#tymethod.layer" class="fn">layer</a>(&self, inner: A) -\> Self::<a href="https://opendal.apache.org/docs/rust/opendal/raw/trait.Layer.html#associatedtype.LayeredAccess" class="associatedtype" title="type opendal::raw::Layer::LayeredAccess">LayeredAccess</a>

Intercept the operations on the underlying storage.

## Auto Trait Implementations<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#synthetic-implementations" class="anchor">Â§</a>

## Blanket Implementations<a href="https://opendal.apache.org/docs/rust/opendal/layers/struct.RetryLayer.html#blanket-implementations" class="anchor">Â§</a>
