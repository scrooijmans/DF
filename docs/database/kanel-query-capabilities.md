# Kanel Query Capabilities

## Short Answer

**Kanel is a one-way type generation tool** - it does NOT provide query capabilities. It only generates TypeScript types from your database schema.

## What Kanel Does

✅ **Type Generation Only**

- Connects to PostgreSQL to introspect schema
- Generates TypeScript type definitions
- Does NOT execute queries
- Does NOT modify database

## Using Kanel Types with Query Tools

You use Kanel-generated types **with your existing query tools**:

### Option 1: Supabase Client (Current Setup)

```typescript
import { supabase } from "$lib/supabase";
import type Charts from "$lib/database-types/public/Charts";

// Use Kanel types for type safety
async function getChart(id: string): Promise<Charts | null> {
  const { data, error } = await supabase
    .from("charts")
    .select("*")
    .eq("id", id)
    .single();

  if (error) return null;
  return data as Charts; // Type assertion needed (Supabase returns string dates)
}
```

### Option 2: pg Package (Node.js)

```typescript
import { Client } from "pg";
import type Charts from "$lib/database-types/public/Charts";

const client = new Client({
  /* connection */
});

async function getChart(id: string): Promise<Charts | null> {
  const result = await client.query<Charts>(
    "SELECT * FROM charts WHERE id = $1",
    [id],
  );
  return result.rows[0] || null;
}
```

### Option 3: Kysely Query Builder (Type-Safe)

Kanel integrates with **Kysely** for type-safe queries:

```bash
bun add kysely
bun add -d kanel-kysely
```

```typescript
import { Kysely } from "kysely";
import type { Database } from "./database-types"; // Generated by kanel-kysely

const db = new Kysely<Database>({
  /* connection */
});

// Fully type-safe queries!
const chart = await db
  .selectFrom("charts")
  .selectAll()
  .where("id", "=", chartId)
  .executeTakeFirst();
// chart is typed as Charts | undefined
```

## Current Architecture

Your codebase uses:

1. **Frontend**: `@supabase/supabase-js` - Supabase client for queries
2. **Backend (Rust)**: `tokio_postgres` - Direct PostgreSQL client
3. **Backend (Node)**: `pg` - PostgreSQL client

**Kanel types work with all of these** - you just need to:

- Import Kanel types
- Use type assertions where needed (for date/string conversions)
- Get full type safety and IntelliSense

## Recommendation

**Keep your current query setup** (Supabase client, pg, etc.) and use Kanel types for:

- ✅ Type safety in function signatures
- ✅ IntelliSense and autocomplete
- ✅ Compile-time type checking
- ✅ Better developer experience

**Don't replace your query tools** - Kanel complements them, doesn't replace them.

## Example: Using Kanel Types with Supabase

```typescript
// chart-service.ts
import { supabase } from "$lib/supabase";
import type Charts from "$lib/database-types/public/Charts";
import type { ChartsInitializer } from "$lib/database-types/public/Charts";
import { ok, err } from "neverthrow";

// Get chart with Kanel types
export async function getChart(id: string): Promise<Result<Charts, Error>> {
  const { data, error } = await supabase
    .from("charts")
    .select("*")
    .eq("id", id)
    .single();

  if (error) return err(new Error(error.message));

  // Convert Supabase format (string dates) to Kanel format (Date)
  const chart: Charts = {
    ...data,
    created_at: new Date(data.created_at),
    updated_at: new Date(data.updated_at),
  };

  return ok(chart);
}

// Create chart with Kanel types
export async function createChart(
  data: ChartsInitializer,
): Promise<Result<Charts, Error>> {
  // Convert Kanel format to Supabase format
  const insertData = {
    ...data,
    created_at: data.created_at?.toISOString(),
    updated_at: data.updated_at?.toISOString(),
  };

  const { data: chart, error } = await supabase
    .from("charts")
    .insert(insertData)
    .select()
    .single();

  if (error) return err(new Error(error.message));

  return ok({
    ...chart,
    created_at: new Date(chart.created_at),
    updated_at: new Date(chart.updated_at),
  } as Charts);
}
```

## Summary

| Tool                | Purpose                 | Query Capabilities              |
| ------------------- | ----------------------- | ------------------------------- |
| **Kanel**           | Type generation         | ❌ No - types only              |
| **Supabase Client** | Database queries        | ✅ Yes - your current tool      |
| **pg**              | Database queries        | ✅ Yes - Node.js client         |
| **Kysely**          | Type-safe query builder | ✅ Yes - works with Kanel types |

**Bottom line**: Kanel generates types, you use those types with your existing query tools for type safety.
